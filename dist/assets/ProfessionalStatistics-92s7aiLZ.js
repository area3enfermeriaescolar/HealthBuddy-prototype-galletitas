import{q as y,c as m,d as f,g as b,w as I,l as T,r as h,j as t}from"./index-BmE4jDWU.js";const U=async()=>{try{const e=y(m(f,"consultations"));return(await b(e)).size}catch(e){throw console.error("Error getting total consultations:",e),e}},X=async()=>{try{const e=y(m(f,"consultations")),n=await b(e),i={};return n.forEach(a=>{const r=a.data().topic||"Desconocido";i[r]=(i[r]||0)+1}),i}catch(e){throw console.error("Error getting consultations by topic:",e),e}},Z=async()=>{try{const e=y(m(f,"consultations")),n=await b(e),i={};for(const a of n.docs){const r=a.data().studentId;if(r){const u=await b(y(m(f,"users"),I("uid","==",r),T(1)));if(!u.empty){const p=u.docs[0].data().course||"Desconocido";i[p]=(i[p]||0)+1}}}return i}catch(e){throw console.error("Error getting consultations by course:",e),e}},_=async()=>{var e;try{const n=y(m(f,"consultations")),i=await b(n),a={"12-14":0,"15-16":0,"17-18":0,Desconocido:0};for(const r of i.docs){const u=r.data().studentId;if(u){const p=await b(y(m(f,"users"),I("uid","==",u),T(1)));if(!p.empty){const g=(e=p.docs[0].data().birthDate)==null?void 0:e.toDate();if(g){const c=new Date;let d=c.getFullYear()-g.getFullYear();const v=c.getMonth()-g.getMonth();(v<0||v===0&&c.getDate()<g.getDate())&&d--,d>=12&&d<=14?a["12-14"]++:d>=15&&d<=16?a["15-16"]++:d>=17&&d<=18?a["17-18"]++:a.Desconocido++}else a.Desconocido++}}}return a}catch(n){throw console.error("Error getting consultations by age group:",n),n}},tt=async()=>{try{const e=y(m(f,"resourceConsultations")),n=await b(e),i={};return n.forEach(r=>{const u=r.data().resourceTitle||"Desconocido";i[u]=(i[u]||0)+1}),Object.entries(i).sort(([,r],[,u])=>u-r)}catch(e){throw console.error("Error getting most accessed resources:",e),e}},et=async()=>{try{const e=y(m(f,"appointments"));return(await b(e)).size}catch(e){throw console.error("Error getting total appointments:",e),e}},ot=async()=>{try{const e=y(m(f,"appointments")),n=await b(e),i={};return n.forEach(a=>{const r=a.data().status||"Desconocido";i[r]=(i[r]||0)+1}),i}catch(e){throw console.error("Error getting appointments by status:",e),e}},s={primary:"#00B7D8",textDark:"#2C3E50",textMedium:"#4A6572",accentGreen:"#27AE60",accentOrange:"#F39C12",accentRed:"#E74C3C",lightBg:"#F7FAFC",lightGrey:"#ECEFF1",purple:"#9C27B0"},D=()=>t.jsx("div",{style:{position:"fixed",top:10,right:10,background:"#00B7D8",color:"#fff",padding:"4px 12px",borderRadius:20,fontSize:"0.75rem",fontWeight:600,letterSpacing:.5,zIndex:1e3},children:"DEMO"}),A=({data:e,title:n,color:i=s.primary})=>{if(!e||e.length===0)return t.jsxs("div",{style:{marginBottom:24},children:[n&&t.jsx("h3",{style:{fontSize:16,marginBottom:16,color:s.textDark},children:n}),t.jsx("p",{style:{color:s.textMedium,fontStyle:"italic"},children:"No hay datos disponibles"})]});const a=Math.max(...e.map(r=>r.value));return t.jsxs("div",{style:{marginBottom:24},children:[n&&t.jsx("h3",{style:{fontSize:16,marginBottom:16,color:s.textDark},children:n}),e.map((r,u)=>t.jsxs("div",{style:{marginBottom:12},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[t.jsx("span",{style:{fontSize:window.innerWidth<480?13:14,color:s.textMedium},children:r.label}),t.jsx("span",{style:{fontSize:window.innerWidth<480?13:14,fontWeight:600,color:s.textDark},children:r.value})]}),t.jsx("div",{style:{width:"100%",height:8,background:s.lightBg,borderRadius:4,overflow:"hidden"},children:t.jsx("div",{style:{width:`${a>0?r.value/a*100:0}%`,height:"100%",background:i,borderRadius:4,transition:"width 0.3s ease"}})})]},u))]})},W=({data:e})=>{const[n,i]=h.useState(typeof window<"u"?window.innerWidth:768);if(h.useEffect(()=>{const c=()=>i(window.innerWidth);return window.addEventListener("resize",c),()=>window.removeEventListener("resize",c)},[]),!e||e.length===0)return t.jsx("p",{style:{color:s.textMedium,fontStyle:"italic"},children:"No hay datos disponibles"});const a=e.reduce((c,d)=>c+d.value,0),r=n<480,u=r?120:150,p=[s.primary,s.accentGreen,s.purple,s.accentOrange,s.accentRed];if(r)return t.jsx("div",{children:e.map((c,d)=>t.jsxs("div",{style:{marginBottom:8},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[t.jsx("div",{style:{width:10,height:10,borderRadius:2,background:p[d%p.length]}}),t.jsx("span",{style:{fontSize:13,color:s.textMedium},children:c.label})]}),t.jsx("span",{style:{fontSize:13,fontWeight:500,color:s.textDark},children:c.value})]}),t.jsx("div",{style:{width:"100%",height:6,background:s.lightBg,borderRadius:3,overflow:"hidden"},children:t.jsx("div",{style:{width:`${a>0?c.value/a*100:0}%`,height:"100%",background:p[d%p.length],borderRadius:3}})})]},d))});let g=0;return t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:32},children:[t.jsxs("div",{style:{width:u,height:u,position:"relative",display:"flex",alignItems:"center",justifyContent:"center"},children:[e.map((c,d)=>{const S=c.value/a*100/100*360,z=p[d%p.length],E=g;return g+=S,t.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",borderRadius:"50%",background:`conic-gradient(${z} ${E}deg ${g}deg, transparent ${g}deg 360deg)`,transform:"rotate(0deg)"}},d)}),t.jsx("div",{style:{position:"absolute",width:"60%",height:"60%",background:"white",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:t.jsx("span",{style:{fontSize:14,fontWeight:600,color:s.textDark},children:a})})]}),t.jsx("div",{children:e.map((c,d)=>t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:8},children:[t.jsx("div",{style:{width:12,height:12,borderRadius:4,background:p[d%p.length]}}),t.jsx("span",{style:{fontSize:14,color:s.textMedium},children:c.label}),t.jsxs("span",{style:{fontSize:14,fontWeight:500,color:s.textDark},children:["(",c.value,")"]})]},d))})]})},C=e=>Object.entries(e).map(([n,i])=>({label:n,value:i})).sort((n,i)=>i.value-n.value),st=e=>e.map(([n,i])=>({label:n,value:i})),it=({onNavigate:e})=>{const[n,i]=h.useState("all"),[a,r]=h.useState("month"),[u,p]=h.useState(!0),[g,c]=h.useState(null),[d,v]=h.useState(typeof window<"u"?window.innerWidth:768),[S,z]=h.useState(0),[E,M]=h.useState(0),[q,$]=h.useState([]),[F,O]=h.useState([]),[B,L]=h.useState([]),[G,N]=h.useState([]),[R,P]=h.useState([]);h.useEffect(()=>{const l=()=>v(window.innerWidth);return window.addEventListener("resize",l),()=>window.removeEventListener("resize",l)},[]),h.useEffect(()=>{(async()=>{try{p(!0),c(null);const[x,j,w,k,H,K,Q]=await Promise.all([U(),et(),X(),Z(),_(),ot(),tt()]);z(x),M(j),$(C(w)),O(C(k)),L(C(H)),N(C(K)),P(st(Q.slice(0,10)))}catch(x){console.error("Error al cargar estadísticas:",x),c("No se pudieron cargar las estadísticas. Verifica tu conexión e inténtalo de nuevo.")}finally{p(!1)}})()},[n,a]);const o=d<480,V=[{id:"all",name:"Todos los centros"},{id:"ies-mediterraneo",name:"IES Mediterráneo"},{id:"ies-san-juan",name:"IES San Juan Bosco"},{id:"ies-mar-menor",name:"IES Mar Menor"}],Y=()=>{if(B.length===0)return"N/A";let l=0,x=0;return B.forEach(j=>{if(j.label!=="Desconocido"){const w=j.label.split("-"),k=w.length>1?(parseInt(w[0])+parseInt(w[1]))/2:parseInt(w[0]);l+=k*j.value,x+=j.value}}),x>0?(l/x).toFixed(1):"N/A"},J=R.reduce((l,x)=>l+x.value,0);return u?t.jsxs("div",{style:{padding:o?"0.75rem":"1rem",paddingBottom:100,maxWidth:800,margin:"0 auto"},children:[t.jsx(D,{}),t.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:16,position:"relative"},children:[t.jsxs("button",{onClick:()=>e("dashboard"),style:{background:"none",border:"none",color:s.primary,fontSize:16,display:"flex",alignItems:"center",gap:4,cursor:"pointer",padding:0,position:"absolute",left:0},children:[t.jsx("span",{style:{fontSize:20},children:"←"})," ",!o&&"Atrás"]}),t.jsx("h1",{style:{flex:1,textAlign:"center",fontWeight:"bold",fontSize:o?16:18},children:"Estadísticas"})]}),t.jsx("div",{style:{textAlign:"center",padding:"30px 0",color:s.textMedium},children:"Cargando estadísticas..."})]}):g?t.jsxs("div",{style:{padding:o?"0.75rem":"1rem",paddingBottom:100,maxWidth:800,margin:"0 auto"},children:[t.jsx(D,{}),t.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:16,position:"relative"},children:[t.jsxs("button",{onClick:()=>e("dashboard"),style:{background:"none",border:"none",color:s.primary,fontSize:16,display:"flex",alignItems:"center",gap:4,cursor:"pointer",padding:0,position:"absolute",left:0},children:[t.jsx("span",{style:{fontSize:20},children:"←"})," ",!o&&"Atrás"]}),t.jsx("h1",{style:{flex:1,textAlign:"center",fontWeight:"bold",fontSize:o?16:18},children:"Estadísticas"})]}),t.jsxs("div",{style:{textAlign:"center",padding:"30px 0",color:s.accentRed},children:[g,t.jsx("br",{}),t.jsx("button",{onClick:()=>window.location.reload(),style:{marginTop:16,background:s.primary,color:"white",border:"none",borderRadius:8,padding:"8px 16px",cursor:"pointer"},children:"Reintentar"})]})]}):t.jsxs("div",{style:{padding:o?"0.75rem":"1rem",paddingBottom:100,maxWidth:800,margin:"0 auto"},children:[t.jsx(D,{}),t.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:16,position:"relative"},children:[t.jsxs("button",{onClick:()=>e("dashboard"),style:{background:"none",border:"none",color:s.primary,fontSize:16,display:"flex",alignItems:"center",gap:4,cursor:"pointer",padding:0,position:"absolute",left:0},children:[t.jsx("span",{style:{fontSize:20},children:"←"})," ",!o&&"Atrás"]}),t.jsx("h1",{style:{flex:1,textAlign:"center",fontWeight:"bold",fontSize:o?16:18},children:"Estadísticas"})]}),t.jsxs("div",{style:{display:"flex",gap:o?8:16,marginBottom:o?16:24,flexDirection:o?"column":"row",flexWrap:"wrap"},children:[t.jsx("select",{value:n,onChange:l=>i(l.target.value),style:{flex:1,minWidth:150,padding:o?"8px 10px":"10px 12px",borderRadius:8,border:`1px solid ${s.lightGrey}`,fontSize:o?13:14,background:"white"},children:V.map(l=>t.jsx("option",{value:l.id,children:l.name},l.id))}),t.jsxs("select",{value:a,onChange:l=>r(l.target.value),style:{flex:1,minWidth:120,padding:o?"8px 10px":"10px 12px",borderRadius:8,border:`1px solid ${s.lightGrey}`,fontSize:o?13:14,background:"white"},children:[t.jsx("option",{value:"week",children:"Última semana"}),t.jsx("option",{value:"month",children:"Último mes"}),t.jsx("option",{value:"quarter",children:"Último trimestre"}),t.jsx("option",{value:"year",children:"Último año"})]})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:`repeat(auto-fit, minmax(${o?"100px":"150px"}, 1fr))`,gap:o?8:16,marginBottom:o?16:24},children:[t.jsxs("div",{style:{background:"white",borderRadius:12,padding:o?12:16,boxShadow:"0 2px 4px rgba(0,0,0,0.05)",textAlign:"center"},children:[t.jsx("div",{style:{fontSize:o?24:32,fontWeight:"bold",color:s.primary},children:S}),t.jsx("div",{style:{fontSize:o?12:14,color:s.textMedium},children:"Total consultas"})]}),t.jsxs("div",{style:{background:"white",borderRadius:12,padding:o?12:16,boxShadow:"0 2px 4px rgba(0,0,0,0.05)",textAlign:"center"},children:[t.jsx("div",{style:{fontSize:o?24:32,fontWeight:"bold",color:s.accentGreen},children:J}),t.jsx("div",{style:{fontSize:o?12:14,color:s.textMedium},children:"Recursos accedidos"})]}),t.jsxs("div",{style:{background:"white",borderRadius:12,padding:o?12:16,boxShadow:"0 2px 4px rgba(0,0,0,0.05)",textAlign:"center"},children:[t.jsx("div",{style:{fontSize:o?24:32,fontWeight:"bold",color:s.purple},children:Y()}),t.jsx("div",{style:{fontSize:o?12:14,color:s.textMedium},children:"Edad promedio"})]})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:`repeat(auto-fit, minmax(${o?"280px":"300px"}, 1fr))`,gap:o?16:24},children:[t.jsx("div",{style:{background:"white",borderRadius:12,padding:o?12:16,boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},children:t.jsx(A,{data:q,title:"Temas más consultados"})}),t.jsx("div",{style:{background:"white",borderRadius:12,padding:o?12:16,boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},children:t.jsx(A,{data:B,title:"Distribución por edad",color:s.purple})})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:`repeat(auto-fit, minmax(${o?"280px":"300px"}, 1fr))`,gap:o?16:24,marginTop:o?16:24},children:[t.jsxs("div",{style:{background:"white",borderRadius:12,padding:o?12:16,boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},children:[t.jsx("h3",{style:{fontSize:o?15:16,marginBottom:16,color:s.textDark},children:"Distribución por curso"}),t.jsx(W,{data:F})]}),t.jsxs("div",{style:{background:"white",borderRadius:12,padding:o?12:16,boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},children:[t.jsx("h3",{style:{fontSize:o?15:16,marginBottom:16,color:s.textDark},children:"Estado de citas"}),t.jsx(W,{data:G})]})]}),R.length>0&&t.jsx("div",{style:{background:"white",borderRadius:12,padding:o?12:16,boxShadow:"0 2px 4px rgba(0,0,0,0.05)",marginTop:o?16:24},children:t.jsx(A,{data:R,title:"Recursos más accedidos",color:s.accentOrange})}),S===0&&t.jsx("div",{style:{background:"white",borderRadius:12,padding:o?12:16,boxShadow:"0 2px 4px rgba(0,0,0,0.05)",marginTop:o?16:24,textAlign:"center"},children:t.jsx("p",{style:{color:s.textMedium,fontStyle:"italic"},children:"No hay datos de consultas disponibles. Las estadísticas aparecerán cuando los usuarios comiencen a utilizar el sistema."})}),t.jsx("div",{style:{marginTop:o?16:24,textAlign:"center"},children:t.jsxs("button",{style:{background:s.primary,color:"white",border:"none",borderRadius:20,padding:o?"8px 16px":"10px 20px",fontSize:o?13:14,fontWeight:500,cursor:"pointer",display:"inline-flex",alignItems:"center",gap:8,width:o?"100%":"auto",justifyContent:"center"},onClick:()=>{alert("Funcionalidad de exportar en desarrollo")},children:[t.jsx("span",{children:"📥"})," Exportar informe"]})}),t.jsx("div",{style:{position:"fixed",left:0,right:0,bottom:0,background:"#fff",boxShadow:"0 -2px 8px rgba(0,0,0,0.08)",display:"flex",justifyContent:"space-around",padding:o?"0.5rem 0":"0.6rem 0",zIndex:40},children:[{id:"dashboard",label:"Inicio",icon:"🏠"},{id:"chat",label:"Chat",icon:"💬"},{id:"appointments",label:"Citas",icon:"📅"},{id:"resources",label:"Recursos",icon:"📚"}].map(l=>t.jsxs("div",{onClick:()=>e(l.id),style:{textAlign:"center",cursor:"pointer",padding:"4px 8px",position:"relative"},children:[t.jsx("div",{style:{fontSize:o?"1.4rem":"1.6rem",color:s.textMedium},children:l.icon}),t.jsx("span",{style:{fontSize:o?11:12,color:s.textMedium,fontWeight:400},children:l.label})]},l.id))})]})};export{it as default};
