import{c as v,r as n,j as e,N,D as g}from"./index-CAa7WQB5.js";/* empty css                         */import{s as C,g as x,c as E,a as S}from"./chatService-Cj2Abw3Q.js";const I=()=>{const{currentUser:t}=v(),[i,l]=n.useState(""),[d,f]=n.useState([]),[u,h]=n.useState([]),[r,o]=n.useState(null),m=n.useRef(null);n.useEffect(()=>{t&&(async()=>{const a=await x(t.uid,t.role);a.success&&(h(a.data),a.data.length>0&&o(a.data[0]))})()},[t]),n.useEffect(()=>{if(r){const s=C(r.id,a=>{f(a)});return()=>s()}},[r]),n.useEffect(()=>{var s;(s=m.current)==null||s.scrollIntoView({behavior:"smooth"})},[d]);const j=async s=>{if(s.preventDefault(),i.trim()&&r&&t){const a={text:i,senderId:t.uid,from:t.role,timestamp:new Date},c=await S(r.id,a);c.success?l(""):console.error("Error al enviar mensaje:",c.error)}},p=async s=>{if(t)try{const a=await E(t.uid,s);if(a.success){o(a.data);const c=await x(t.uid,t.role);c.success&&h(c.data)}else console.error("Error al crear chat:",a.error)}catch(a){console.error("Error al crear chat:",a)}};return t?e.jsxs("div",{className:"student-chat-container",children:[e.jsx(N,{}),e.jsx(g,{}),e.jsxs("div",{className:"chat-interface",children:[e.jsxs("div",{className:"chat-sidebar",children:[e.jsx("h3",{children:"Tus Chats"}),u.length===0?e.jsx("p",{children:"No tienes chats activos. Inicia una conversaciÃ³n con un profesional."}):e.jsx("ul",{children:u.map(s=>e.jsx("li",{onClick:()=>o(s),className:(r==null?void 0:r.id)===s.id?"selected":"",children:t.role==="student"?s.professionalName:s.studentName},s.id))}),e.jsx("button",{onClick:()=>p("PROFESSIONAL_ID_EXAMPLE"),children:"Iniciar Nuevo Chat"})]}),e.jsx("div",{className:"chat-main",children:r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"chat-header",children:e.jsxs("h2",{children:["Chat con ",t.role==="student"?r.professionalName:r.studentName]})}),e.jsxs("div",{className:"messages-list",children:[d.map(s=>{var a;return e.jsxs("div",{className:`message ${s.senderId===t.uid?"sent":"received"}`,children:[e.jsx("p",{children:s.text}),e.jsx("span",{children:new Date((a=s.timestamp)==null?void 0:a.toDate()).toLocaleTimeString()})]},s.id)}),e.jsx("div",{ref:m})]}),e.jsxs("form",{onSubmit:j,className:"message-input-form",children:[e.jsx("input",{type:"text",value:i,onChange:s=>l(s.target.value),placeholder:"Escribe un mensaje..."}),e.jsx("button",{type:"submit",children:"Enviar"})]})]}):e.jsx("div",{className:"no-chat-selected",children:e.jsx("p",{children:"Selecciona un chat para empezar a conversar o inicia uno nuevo."})})})]})]}):e.jsx("div",{children:"Cargando usuario..."})};export{I as default};
