import{r as a,j as t}from"./index-BmE4jDWU.js";import{b as F,g as A}from"./chatService-MCjf1RFD.js";import{u as O}from"./AuthContext-CedbsvhE.js";const n={primary:"#00B7D8",textDark:"#2C3E50",textMedium:"#4A6572",lightBg:"#F7FAFC",lightGrey:"#ECEFF1",danger:"#E74C3C"},w=()=>t.jsx("div",{style:{position:"fixed",top:10,right:10,background:"#00B7D8",color:"#fff",padding:"4px 12px",borderRadius:20,fontSize:"0.75rem",fontWeight:600,letterSpacing:.5,zIndex:1e3},children:"DEMO"}),T=[{id:"demo-est1",nre:"30012345",center:"IES MediterrÃ¡neo",unread:!0,participantIds:["demo-professional","demo-student1"],lastMessage:{text:"Â¿Es seguro usar solo preservativo o deberÃ­a combinar con otro mÃ©todo?",timestamp:new Date(Date.now()-3e5),senderId:"demo-student1"}},{id:"demo-est2",nre:"30023456",center:"IES Mar Menor",unread:!1,participantIds:["demo-professional","demo-student2"],lastMessage:{text:"Entiendo. Â¿Te gustarÃ­a que hablemos sobre esto en tu prÃ³xima cita?",timestamp:new Date(Date.now()-72e5),senderId:"demo-professional"}},{id:"demo-est3",nre:"30034567",center:"IES Mar Menor",unread:!0,participantIds:["demo-professional","demo-student3"],lastMessage:{text:"Hola, Â¿cuÃ¡ndo es tu prÃ³xima visita a nuestro instituto?",timestamp:new Date(Date.now()-144e5),senderId:"demo-student3"}}],Y=({onNavigate:g})=>{const{currentUser:d}=O(),[x,C]=a.useState(""),[r,h]=a.useState(null),[c,y]=a.useState(""),[b,m]=a.useState([]),[I,j]=a.useState([]),[R,f]=a.useState(!0),[l,p]=a.useState(null),M=a.useRef(null),k=a.useRef(null);a.useEffect(()=>{d?(f(!0),(async()=>{try{const s=await A(d.uid,"professional");s.success?m(s.data):(console.error("Error loading chats:",s.message),p("Error al cargar las conversaciones")),f(!1)}catch(s){console.error("Error loading chats:",s),p("Error al cargar las conversaciones"),f(!1)}})()):(m(T),f(!1))},[d]),a.useEffect(()=>{if(r)if(d){const e=F(r.id);return()=>e()}else{const e=[{id:"1",senderId:r.participantIds.find(s=>s!=="demo-professional"),text:B(r.id),timestamp:new Date(Date.now()-36e5),senderName:`Estudiante ${r.nre}`},{id:"2",senderId:"demo-professional",text:"Hola, cuÃ©ntame en quÃ© puedo ayudarte.",timestamp:new Date(Date.now()-35e5),senderName:"Profesional"},{id:"3",senderId:r.participantIds.find(s=>s!=="demo-professional"),text:r.lastMessage.text,timestamp:r.lastMessage.timestamp,senderName:`Estudiante ${r.nre}`}];j(e)}},[r,d]);const B=e=>({"demo-est1":"Buenos dÃ­as, tengo una duda sobre mÃ©todos anticonceptivos.","demo-est2":"No me encuentro bien hoy, tengo mucha ansiedad por los exÃ¡menes.","demo-est3":"Hola, Â¿cuÃ¡ndo es tu prÃ³xima visita a nuestro instituto?"})[e]||"Hola, necesito ayuda con un tema de salud.";a.useEffect(()=>{var e;(e=M.current)==null||e.scrollIntoView({behavior:"smooth"})},[I]);const z=b.reduce((e,s)=>{const o=s.center||"Centro Desconocido";return e[o]||(e[o]=[]),e[o].push(s),e},{}),L=e=>e.nre&&e.nre.toLowerCase().includes(x.toLowerCase())||e.center&&e.center.toLowerCase().includes(x.toLowerCase()),v=async()=>{if(c.trim()){if(d&&r)try{const e=r.participantIds.find(s=>s!==d.uid);await v(r.id,d.uid,e,c.trim()),y(""),p(null)}catch(e){console.error("Error al enviar mensaje:",e),p("Error al enviar el mensaje. IntÃ©ntalo de nuevo.")}else{console.log("Mensaje enviado (demo):",c);const e={id:Date.now().toString(),senderId:"demo-professional",text:c,timestamp:new Date,senderName:"Profesional"};j(s=>[...s,e]),y(""),setTimeout(()=>{const s=["Gracias por la informaciÃ³n.","Entiendo, lo tendrÃ© en cuenta.","Â¿PodrÃ­amos hablar de esto en la prÃ³xima consulta?","Vale, intentarÃ© seguir tu consejo.","Â¿Hay algo mÃ¡s que deba saber sobre esto?"],o=s[Math.floor(Math.random()*s.length)],i=r.participantIds.find(u=>u!=="demo-professional"),E={id:(Date.now()+1e3).toString(),senderId:i,text:o,timestamp:new Date,senderName:`Estudiante ${r.nre}`};j(u=>[...u,E]),m(u=>u.map(S=>S.id===r.id?{...S,unread:!0,lastMessage:E}:S))},2e3+Math.random()*3e3)}setTimeout(()=>{var e;(e=k.current)==null||e.focus()},0)}},N=e=>{if(e.unread){const s=b.map(o=>o.id===e.id?{...o,unread:!1}:o);m(s),h({...e,unread:!1})}else h(e);p(null)},W=e=>{e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),v())},D=e=>e?(e.toDate?e.toDate():new Date(e)).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"",$=e=>d?e.senderId===d.uid:e.senderId==="demo-professional";return R?t.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:n.lightBg,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[t.jsx(w,{}),t.jsx("span",{style:{color:n.textMedium},children:"Cargando conversaciones..."})]}):r?t.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:n.lightBg,display:"flex",flexDirection:"column"},children:[t.jsx(w,{}),t.jsx("div",{style:{background:"white",padding:"1rem",boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},children:t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[t.jsx("button",{onClick:()=>h(null),style:{background:"none",border:"none",color:n.primary,fontSize:24,cursor:"pointer",padding:0},children:"â†"}),t.jsxs("div",{children:[t.jsxs("h2",{style:{margin:0,fontSize:16,color:n.textDark,display:"flex",alignItems:"center",gap:8},children:[t.jsx("span",{style:{fontSize:18,color:n.primary},children:"ðŸ‘¤"})," NRE: ",r.nre]}),t.jsxs("p",{style:{fontSize:13,color:n.textMedium,margin:"4px 0 0 0",display:"flex",alignItems:"center",gap:6},children:[t.jsx("span",{style:{fontSize:14,color:n.primary},children:"ðŸ«"})," ",r.center]})]})]}),t.jsxs("button",{style:{background:"none",border:`1px solid ${n.primary}`,color:n.primary,borderRadius:8,padding:"6px 10px",fontSize:13,cursor:"pointer",display:"flex",alignItems:"center",gap:6},children:[t.jsx("span",{children:"ðŸ“‹"})," Ver historial"]})]})}),t.jsxs("div",{style:{background:n.danger,color:"white",padding:"10px 12px",display:"flex",alignItems:"center",gap:8,fontSize:13},children:[t.jsx("span",{style:{fontSize:16},children:"ðŸ”’"})," Esta consulta es confidencial y anÃ³nima."]}),l&&t.jsx("div",{style:{margin:"12px",padding:"12px",backgroundColor:"#ffebee",borderRadius:8,borderLeft:`4px solid ${n.danger}`,color:n.danger,fontSize:14},children:l}),t.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"1rem",paddingBottom:"80px"},children:[I.map((e,s)=>{const o=$(e);return t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:o?"flex-end":"flex-start",marginBottom:16},children:[t.jsx("div",{style:{background:o?n.primary:"white",color:o?"white":n.textDark,padding:"10px 16px",borderRadius:16,borderBottomLeftRadius:o?16:4,borderBottomRightRadius:o?4:16,maxWidth:"80%",wordBreak:"break-word",boxShadow:o?"none":"0 2px 4px rgba(0,0,0,0.05)",fontSize:14},children:e.text}),t.jsx("span",{style:{fontSize:11,color:n.textMedium,marginTop:4,alignSelf:o?"flex-end":"flex-start"},children:D(e.timestamp)})]},e.id||s)}),t.jsx("div",{ref:M})]}),t.jsx("div",{style:{position:"absolute",bottom:"60px",left:0,right:0,background:"white",borderTop:`1px solid ${n.lightGrey}`,padding:"8px 12px",boxShadow:"0 -2px 10px rgba(0,0,0,0.05)"},children:t.jsxs("div",{style:{display:"flex",gap:8,maxWidth:800,margin:"0 auto"},children:[t.jsx("textarea",{ref:k,value:c,onChange:e=>y(e.target.value),onKeyDown:W,placeholder:"Escribe un mensaje...",disabled:!!l,style:{flex:1,padding:"8px 12px",borderRadius:20,border:`1px solid ${n.lightGrey}`,resize:"none",fontSize:14,minHeight:40,maxHeight:120,backgroundColor:n.lightBg,fontFamily:"inherit",outline:"none",opacity:l?.6:1},rows:1}),t.jsx("button",{onClick:v,disabled:!c.trim()||!!l,style:{background:c.trim()&&!l?n.primary:"#ccc",color:"white",border:"none",borderRadius:"50%",width:40,height:40,display:"flex",alignItems:"center",justifyContent:"center",cursor:c.trim()&&!l?"pointer":"not-allowed",fontSize:20,flexShrink:0},children:"â†‘"})]})}),t.jsx("div",{style:{position:"fixed",left:0,right:0,bottom:0,background:"#fff",boxShadow:"0 -2px 8px rgba(0,0,0,0.08)",display:"flex",justifyContent:"space-around",padding:"0.6rem 0",zIndex:40,height:"60px"},children:[{id:"dashboard",label:"Inicio",icon:"ðŸ "},{id:"chat",label:"Chat",icon:"ðŸ’¬"},{id:"appointments",label:"Citas",icon:"ðŸ“…"},{id:"resources",label:"Recursos",icon:"ðŸ“š"}].map(e=>t.jsxs("div",{onClick:()=>g(e.id),style:{textAlign:"center",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[t.jsx("div",{style:{fontSize:"1.6rem",color:e.id==="chat"?n.primary:n.textMedium},children:e.icon}),t.jsx("span",{style:{fontSize:12,color:e.id==="chat"?n.primary:n.textMedium,fontWeight:e.id==="chat"?600:400},children:e.label})]},e.id))})]}):t.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:n.lightBg,display:"flex",flexDirection:"column"},children:[t.jsx(w,{}),t.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"1rem",position:"relative",backgroundColor:"white",boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},children:[t.jsxs("button",{onClick:()=>g("dashboard"),style:{background:"none",border:"none",color:n.primary,fontSize:16,display:"flex",alignItems:"center",gap:4,cursor:"pointer",padding:0,position:"absolute",left:"1rem"},children:[t.jsx("span",{style:{fontSize:20},children:"â†"})," AtrÃ¡s"]}),t.jsx("h1",{style:{flex:1,textAlign:"center",fontWeight:"bold",fontSize:18,margin:0},children:"Chat con estudiantes"})]}),l&&t.jsx("div",{style:{margin:"1rem",padding:"12px",backgroundColor:"#ffebee",borderRadius:8,borderLeft:`4px solid ${n.danger}`,color:n.danger,fontSize:14},children:l}),t.jsx("div",{style:{padding:"1rem"},children:t.jsxs("div",{style:{position:"relative"},children:[t.jsx("input",{value:x,onChange:e=>C(e.target.value),placeholder:"Buscar por NRE o centro",style:{width:"100%",padding:"8px 16px 8px 36px",borderRadius:8,border:`1px solid ${n.lightGrey}`,fontSize:14}}),t.jsx("span",{style:{position:"absolute",left:12,top:"50%",transform:"translateY(-50%)",color:n.textMedium,fontSize:18},children:"ðŸ”"}),x&&t.jsx("button",{onClick:()=>C(""),style:{position:"absolute",right:12,top:"50%",transform:"translateY(-50%)",background:"none",border:"none",color:n.textMedium,fontSize:16,cursor:"pointer"},children:"âœ•"})]})}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0 1rem",marginBottom:"1rem"},children:[t.jsx("span",{style:{fontSize:14,color:n.textMedium},children:"Conversaciones activas"}),t.jsxs("span",{style:{background:n.primary,color:"white",borderRadius:20,padding:"4px 12px",fontSize:13,fontWeight:500},children:[b.filter(e=>e.unread).length," sin leer"]})]}),t.jsx("div",{style:{flex:1,overflowY:"auto",padding:"0 1rem",paddingBottom:"80px"},children:Object.keys(z).length===0?t.jsxs("div",{style:{textAlign:"center",padding:"40px 20px",color:n.textMedium},children:[t.jsx("p",{children:"No tienes conversaciones activas."}),t.jsx("p",{style:{fontSize:"0.9rem"},children:d?"Los estudiantes pueden iniciar conversaciones contigo desde su aplicaciÃ³n.":"En modo demo se muestran conversaciones de ejemplo."})]}):Object.entries(z).map(([e,s])=>{const o=s.filter(L);return o.length===0?null:t.jsxs("div",{style:{marginBottom:24},children:[t.jsxs("h2",{style:{color:n.textDark,marginBottom:12,fontSize:16,display:"flex",alignItems:"center",gap:8},children:[t.jsx("span",{style:{fontSize:18,color:n.primary},children:"ðŸ«"})," ",e]}),o.map(i=>t.jsx("div",{onClick:()=>N(i),style:{background:"white",padding:12,borderRadius:12,marginBottom:12,cursor:"pointer",boxShadow:"0 2px 4px rgba(0,0,0,0.05)",borderLeft:i.unread?`4px solid ${n.primary}`:"none",paddingLeft:i.unread?8:12},children:t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsxs("div",{style:{flex:1},children:[t.jsxs("p",{style:{margin:0,fontWeight:i.unread?600:500,color:n.textDark,display:"flex",alignItems:"center",gap:6,fontSize:14},children:[t.jsx("span",{style:{fontSize:16,color:n.primary},children:"ðŸ‘¤"}),"NRE: ",i.nre]}),t.jsxs("div",{style:{fontSize:12,color:i.unread?n.textDark:n.textMedium,marginTop:4,display:"flex",alignItems:"center",gap:4},children:[t.jsx("span",{style:{maxWidth:"180px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"inline-block"},children:i.lastMessage?i.lastMessage.text:"No hay mensajes"}),t.jsxs("span",{style:{fontSize:11,color:n.textMedium},children:["â€¢ ",i.lastMessage?D(i.lastMessage.timestamp):""]})]})]}),i.unread&&t.jsx("span",{style:{background:n.primary,color:"white",width:24,height:24,borderRadius:12,display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,fontWeight:"bold"},children:"!"})]})},i.id))]},e)})}),t.jsx("div",{style:{position:"fixed",left:0,right:0,bottom:0,background:"#fff",boxShadow:"0 -2px 8px rgba(0,0,0,0.08)",display:"flex",justifyContent:"space-around",padding:"0.6rem 0",zIndex:40,height:"60px"},children:[{id:"dashboard",label:"Inicio",icon:"ðŸ "},{id:"chat",label:"Chat",icon:"ðŸ’¬"},{id:"appointments",label:"Citas",icon:"ðŸ“…"},{id:"resources",label:"Recursos",icon:"ðŸ“š"}].map(e=>t.jsxs("div",{onClick:()=>g(e.id),style:{textAlign:"center",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[t.jsx("div",{style:{fontSize:"1.6rem",color:e.id==="chat"?n.primary:n.textMedium},children:e.icon}),t.jsx("span",{style:{fontSize:12,color:e.id==="chat"?n.primary:n.textMedium,fontWeight:e.id==="chat"?600:400},children:e.label})]},e.id))})]})};export{Y as default};
