import{q as c,d as i,e as o,w as n,o as l,h as m,i as g,k as f,l as I,s as u,g as p}from"./index-CAa7WQB5.js";const h=async s=>{try{if(!s.studentId||!s.professionalId||!s.centerId||!s.date||!s.time)return{success:!1,message:"Faltan datos requeridos para la cita"};const e=await p(i(o,"appointments"),{...s,status:s.status||"pending",createdAt:u(),updatedAt:u()});return await p(i(o,"audit"),{action:"create",resource:"appointment",resourceId:e.id,userId:s.studentId,userType:"student",timestamp:u(),metadata:{professionalId:s.professionalId,centerId:s.centerId,date:s.date}}),{success:!0,message:"Cita creada correctamente",data:{id:e.id,...s}}}catch(e){return console.error("Error al crear cita:",e),{success:!1,message:"Error al crear la cita",error:e.message}}},w=async s=>{try{const e=c(i(o,"appointments"),n("studentId","==",s),l("date","asc")),a=await m(e),t=[];return a.forEach(r=>{t.push({id:r.id,...r.data()})}),{success:!0,data:t}}catch(e){return console.error("Error al obtener citas del estudiante:",e),{success:!1,message:"Error al obtener citas",error:e.message}}},E=async(s,e={})=>{try{let a=c(i(o,"appointments"),n("professionalId","==",s));e.date&&(a=c(a,n("date","==",e.date))),e.centerId&&(a=c(a,n("centerId","==",e.centerId))),e.status&&(a=c(a,n("status","==",e.status))),a=c(a,l("date","asc"),l("time","asc"));const t=await m(a),r=[];return t.forEach(d=>{r.push({id:d.id,...d.data()})}),{success:!0,data:r}}catch(a){return console.error("Error al obtener citas del profesional:",a),{success:!1,message:"Error al obtener citas programadas",error:a.message}}},q=async(s,e,a,t)=>{try{const r=g(o,"appointments",s),d=await f(r);if(!d.exists())throw new Error("La cita no existe");return await I(r,{status:e,updatedAt:u()}),await p(i(o,"audit"),{action:"update",resource:"appointment",resourceId:s,userId:a,userType:t,timestamp:u(),metadata:{previousStatus:d.data().status,newStatus:e}}),{success:!0,message:"Estado de la cita actualizado correctamente"}}catch(r){return console.error("Error al actualizar estado de cita:",r),{success:!1,message:"Error al actualizar el estado de la cita",error:r.message}}};export{E as a,h as c,w as g,q as u};
