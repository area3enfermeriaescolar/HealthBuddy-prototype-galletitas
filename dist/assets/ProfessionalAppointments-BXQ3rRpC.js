import{c as I,r as u,j as r}from"./index-CAa7WQB5.js";import{P as v}from"./ProfessionalLayout-B9zIaFWN.js";import{a as L,u as M}from"./appointmentService-C9QCYLor.js";const m=e=>{if(!e)return"";if(e.seconds)return new Date(e.seconds*1e3).toLocaleDateString("es-ES");if(e instanceof Date)return e.toLocaleDateString("es-ES");if(typeof e=="string"&&e.includes("-")){const[d,i,l]=e.split("-");return`${l}/${i}/${d}`}return e},T=e=>{const d=new Date().toISOString().split("T")[0],i=new Date;i.setDate(i.getDate()+1);const l=i.toISOString().split("T")[0];let a=e;return e&&e.seconds?a=new Date(e.seconds*1e3).toISOString().split("T")[0]:e instanceof Date&&(a=e.toISOString().split("T")[0]),a===d?`Hoy - ${m(e)}`:a===l?`Mañana - ${m(e)}`:m(e)},F=()=>r.jsx("div",{style:{position:"fixed",top:10,right:10,background:"#00B7D8",color:"#fff",padding:"4px 12px",borderRadius:20,fontSize:"0.75rem",fontWeight:600,letterSpacing:.5,zIndex:1e3},children:"DEMO"}),t={primary:"#00B7D8",textDark:"#2C3E50",textMedium:"#4A6572",lightBg:"#F7FAFC",lightGrey:"#ECEFF1",accent:"#4CAF50",warning:"#FF9800",danger:"#E74C3C"},$=({appointment:e,onStatusChange:d,isUpdating:i})=>{const l=c=>{switch(c){case"confirmed":case"completed":return t.accent;case"cancelled":return t.danger;case"pending":return t.warning;default:return t.textMedium}},a=c=>{switch(c){case"confirmed":return"Confirmada";case"completed":return"Completada";case"cancelled":return"Cancelada";case"pending":return"Pendiente";default:return"Desconocido"}};return r.jsxs("div",{style:{background:"white",borderRadius:12,padding:16,marginBottom:12,boxShadow:"0 2px 4px rgba(0,0,0,0.05)",opacity:i===e.id?.6:1,transition:"opacity 0.3s ease"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:12,flexWrap:"wrap"},children:[r.jsxs("div",{children:[r.jsx("h3",{style:{margin:0,fontSize:16,color:t.textDark},children:e.studentName||`NRE: ${e.studentId}`}),r.jsx("p",{style:{margin:"4px 0 0 0",fontSize:14,color:t.textMedium},children:e.center||e.location||"Centro no especificado"})]}),r.jsx("div",{style:{background:`${l(e.status)}10`,padding:"4px 10px",borderRadius:16,fontSize:12,color:l(e.status),fontWeight:500,marginTop:window.innerWidth<480?8:0},children:a(e.status)})]}),r.jsxs("div",{style:{display:"flex",gap:12,marginBottom:12,flexWrap:"wrap"},children:[r.jsxs("div",{style:{background:t.lightBg,padding:"4px 10px",borderRadius:8,fontSize:13,color:t.textMedium,display:"flex",alignItems:"center",gap:4},children:[r.jsx("span",{children:"📅"})," ",m(e.date)]}),r.jsxs("div",{style:{background:t.lightBg,padding:"4px 10px",borderRadius:8,fontSize:13,color:t.textMedium,display:"flex",alignItems:"center",gap:4},children:[r.jsx("span",{children:"⏰"})," ",e.time]}),r.jsxs("div",{style:{background:t.lightBg,padding:"4px 10px",borderRadius:8,fontSize:13,color:t.textMedium,display:"flex",alignItems:"center",gap:4},children:[r.jsx("span",{children:e.type==="presencial"?"🏥":"💻"}),e.type||"presencial"]})]}),r.jsxs("div",{style:{fontSize:14,color:t.textMedium,marginBottom:12},children:[r.jsx("span",{style:{fontWeight:500},children:"Motivo:"})," ",e.reason||"No especificado"]}),e.notes&&r.jsxs("div",{style:{fontSize:13,color:t.textMedium,marginBottom:12,fontStyle:"italic",background:"#f9f9f9",padding:8,borderRadius:6},children:[r.jsx("span",{style:{fontWeight:500},children:"Notas:"}),' "',e.notes,'"']}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexDirection:window.innerWidth<480?"column":"row",gap:window.innerWidth<480?10:0},children:[r.jsx("div",{style:{fontSize:12,color:t.textMedium,marginBottom:window.innerWidth<480?8:0},children:e.createdAt&&r.jsxs("span",{children:["Solicitada: ",new Date(e.createdAt.seconds*1e3).toLocaleDateString("es-ES")]})}),r.jsxs("div",{style:{display:"flex",gap:8,width:window.innerWidth<480?"100%":"auto"},children:[e.status==="pending"&&r.jsxs(r.Fragment,{children:[r.jsx("button",{onClick:()=>d(e.id,"confirmed"),disabled:i===e.id,style:{background:t.accent,color:"white",border:"none",borderRadius:8,padding:"6px 12px",fontSize:13,cursor:i===e.id?"not-allowed":"pointer",flex:window.innerWidth<480?1:"none",opacity:i===e.id?.6:1},children:i===e.id?"...":"Confirmar"}),r.jsx("button",{onClick:()=>d(e.id,"cancelled"),disabled:i===e.id,style:{background:t.danger,color:"white",border:"none",borderRadius:8,padding:"6px 12px",fontSize:13,cursor:i===e.id?"not-allowed":"pointer",flex:window.innerWidth<480?1:"none",opacity:i===e.id?.6:1},children:i===e.id?"...":"Rechazar"})]}),e.status==="confirmed"&&r.jsxs(r.Fragment,{children:[r.jsx("button",{onClick:()=>d(e.id,"completed"),disabled:i===e.id,style:{background:t.primary,color:"white",border:"none",borderRadius:8,padding:"6px 12px",fontSize:13,cursor:i===e.id?"not-allowed":"pointer",flex:window.innerWidth<480?1:"none",opacity:i===e.id?.6:1},children:i===e.id?"...":"Completar"}),r.jsx("button",{onClick:()=>d(e.id,"cancelled"),disabled:i===e.id,style:{background:t.danger,color:"white",border:"none",borderRadius:8,padding:"6px 12px",fontSize:13,cursor:i===e.id?"not-allowed":"pointer",flex:window.innerWidth<480?1:"none",opacity:i===e.id?.6:1},children:i===e.id?"...":"Cancelar"})]}),(e.status==="completed"||e.status==="cancelled")&&r.jsx("button",{onClick:()=>d(e.id,"pending"),disabled:i===e.id,style:{background:t.warning,color:"white",border:"none",borderRadius:8,padding:"6px 12px",fontSize:13,cursor:i===e.id?"not-allowed":"pointer",width:window.innerWidth<480?"100%":"auto",opacity:i===e.id?.6:1},children:i===e.id?"...":"Reactivar"})]})]})]})},O=({activeFilter:e,onFilterChange:d})=>{const i=[{id:"all",label:"Todas"},{id:"pending",label:"Pendientes"},{id:"confirmed",label:"Confirmadas"},{id:"completed",label:"Completadas"},{id:"cancelled",label:"Canceladas"}],l=window.innerWidth<480;return r.jsx("div",{style:{display:"flex",gap:8,overflowX:"auto",paddingBottom:8,marginBottom:16,flexWrap:l?"wrap":"nowrap"},children:i.map(a=>r.jsx("button",{onClick:()=>d(a.id),style:{background:e===a.id?t.primary:"white",color:e===a.id?"white":t.textMedium,border:`1px solid ${e===a.id?t.primary:t.lightGrey}`,borderRadius:20,padding:"6px 16px",fontSize:14,fontWeight:e===a.id?500:"normal",cursor:"pointer",whiteSpace:"nowrap",flex:l?"1 0 auto":"none",minWidth:l?"30%":"auto",textAlign:"center",marginBottom:l?4:0},children:a.label},a.id))})},Y=({onNavigate:e})=>{const{currentUser:d}=I(),[i,l]=u.useState([]),[a,c]=u.useState(!0),[h,y]=u.useState("all"),[f,b]=u.useState(""),[P,k]=u.useState(window.innerWidth),[w,g]=u.useState(null),[z,j]=u.useState(null);u.useEffect(()=>{const o=()=>{k(window.innerWidth)};return window.addEventListener("resize",o),()=>{window.removeEventListener("resize",o)}},[]),u.useEffect(()=>{if(!d){c(!1),g("Debe iniciar sesión para ver las citas");return}c(!0),g(null);try{const o=d.uid;return(async()=>{const n=await L(o);n.success?(console.log("Citas recibidas:",n.data),l(n.data)):g(n.message||"Error al cargar las citas"),c(!1)})(),()=>{}}catch(o){console.error("Error al cargar citas del profesional:",o),g("Error al cargar las citas"),c(!1)}},[d]);const D=async(o,s)=>{if(!o||!s){console.error("ID de cita o nuevo estado no válido");return}if(["cancelled","completed"].includes(s)){const x=s==="cancelled"?"cancelar":"completar";if(!window.confirm(`¿Está seguro de que desea ${x} esta cita?`))return}j(o),g(null);try{await M(o,s),console.log(`Cita ${o} actualizada a estado: ${s}`)}catch(x){console.error("Error al actualizar estado de cita:",x),g(`Error al actualizar la cita: ${x.message}`)}finally{j(null)}},S=i.filter(o=>{if(!(h==="all"||o.status===h))return!1;if(f==="")return!0;const n=f.toLowerCase(),x=(o.studentName||"").toLowerCase(),W=(o.studentId||"").toLowerCase(),A=(o.center||o.location||"").toLowerCase(),B=(o.reason||"").toLowerCase(),E=(o.notes||"").toLowerCase();return x.includes(n)||W.includes(n)||A.includes(n)||B.includes(n)||E.includes(n)}),p=S.reduce((o,s)=>{let n;return s.date&&s.date.seconds?n=new Date(s.date.seconds*1e3).toISOString().split("T")[0]:s.date instanceof Date?n=s.date.toISOString().split("T")[0]:typeof s.date=="string"?n=s.date.includes("T")?s.date.split("T")[0]:s.date:n="fecha-desconocida",o[n]||(o[n]=[]),o[n].push(s),o},{}),R=Object.keys(p).sort((o,s)=>o==="fecha-desconocida"?1:s==="fecha-desconocida"?-1:new Date(o)-new Date(s)),C=()=>{e("dashboard")};return d?r.jsxs(v,{title:"Gestión de Citas",onBack:C,activeScreen:"appointments",onNavigate:e,children:[r.jsx(F,{}),w&&r.jsxs("div",{style:{background:"#ffebee",borderLeft:`4px solid ${t.danger}`,color:t.danger,padding:"1rem",borderRadius:8,marginBottom:"1rem",display:"flex",alignItems:"center",gap:10},children:[r.jsx("span",{style:{fontSize:"1.2rem"},children:"⚠️"}),r.jsxs("div",{children:[r.jsx("p",{style:{margin:0,fontWeight:500},children:"Error"}),r.jsx("p",{style:{margin:"0.2rem 0 0 0",fontSize:"0.9rem"},children:w})]})]}),r.jsxs("div",{style:{position:"relative",marginBottom:16},children:[r.jsx("input",{type:"text",value:f,onChange:o=>b(o.target.value),placeholder:"Buscar por estudiante, NRE, centro, motivo...",style:{width:"100%",padding:"10px 16px 10px 40px",borderRadius:8,border:`1px solid ${t.lightGrey}`,fontSize:14}}),r.jsx("span",{style:{position:"absolute",left:12,top:"50%",transform:"translateY(-50%)",color:t.textMedium,fontSize:18},children:"🔍"}),f&&r.jsx("button",{onClick:()=>b(""),style:{position:"absolute",right:12,top:"50%",transform:"translateY(-50%)",background:"none",border:"none",color:t.textMedium,fontSize:16,cursor:"pointer"},children:"✕"})]}),r.jsx(O,{activeFilter:h,onFilterChange:y}),!a&&i.length>0&&r.jsx("div",{style:{display:"flex",gap:12,marginBottom:20,flexWrap:"wrap"},children:[{status:"pending",label:"Pendientes",color:t.warning},{status:"confirmed",label:"Confirmadas",color:t.primary},{status:"completed",label:"Completadas",color:t.accent}].map(o=>{const s=i.filter(n=>n.status===o.status).length;return r.jsxs("div",{style:{background:"white",borderRadius:8,padding:"8px 12px",display:"flex",alignItems:"center",gap:8,flex:1,minWidth:"fit-content",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:[r.jsx("div",{style:{width:8,height:8,borderRadius:4,background:o.color}}),r.jsxs("span",{style:{fontSize:13,color:t.textMedium},children:[o.label,": ",r.jsx("strong",{children:s})]})]},o.status)})}),a?r.jsxs("div",{style:{textAlign:"center",padding:"30px 0",color:t.textMedium,background:"white",borderRadius:12},children:[r.jsx("div",{style:{fontSize:40,marginBottom:16},children:"⏳"}),r.jsx("p",{children:"Cargando citas..."})]}):S.length===0?r.jsxs("div",{style:{textAlign:"center",padding:"30px 0",color:t.textMedium,background:"white",borderRadius:12,marginTop:16},children:[r.jsx("div",{style:{fontSize:40,marginBottom:16},children:"📅"}),r.jsx("h3",{style:{margin:"0 0 8px 0",color:t.textDark},children:i.length===0?"No hay citas programadas":"No se encontraron citas"}),r.jsxs("p",{style:{margin:"0 0 16px 0"},children:[h!=="all"&&`con estado "${h}" `,f&&`que coincidan con "${f}"`]}),h!=="all"&&r.jsx("button",{onClick:()=>y("all"),style:{background:t.primary,color:"white",border:"none",borderRadius:20,padding:"8px 16px",cursor:"pointer",fontSize:14,fontWeight:500},children:"Ver todas las citas"})]}):R.map(o=>r.jsxs("div",{style:{marginBottom:24},children:[r.jsxs("h2",{style:{margin:"0 0 12px 0",fontSize:16,color:t.textDark,display:"flex",alignItems:"center",gap:8},children:[r.jsx("span",{style:{background:t.primary,color:"white",width:24,height:24,borderRadius:12,display:"flex",alignItems:"center",justifyContent:"center",fontSize:14},children:p[o].length}),o==="fecha-desconocida"?"Fecha no especificada":T(o)]}),p[o].sort((s,n)=>s.time&&n.time?s.time.localeCompare(n.time):0).map(s=>r.jsx($,{appointment:s,onStatusChange:D,isUpdating:z},s.id))]},o)),r.jsx("div",{style:{marginTop:24},children:r.jsxs("button",{onClick:()=>{console.log("Función de crear nueva cita - por implementar")},style:{width:"100%",padding:"12px",background:t.primary,border:"none",borderRadius:8,color:"white",fontSize:14,fontWeight:500,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:8,opacity:.7},disabled:!0,children:[r.jsx("span",{children:"➕"})," Crear nueva cita (Próximamente)"]})}),r.jsx("div",{style:{background:"#f9f9f9",borderRadius:8,padding:"12px",marginTop:16,fontSize:13,color:t.textMedium,textAlign:"center"},children:r.jsx("p",{style:{margin:0},children:"💡 Las citas se actualizan en tiempo real. Los estudiantes recibirán notificaciones automáticas de los cambios de estado."})})]}):r.jsx(v,{title:"Acceso Denegado",onBack:C,activeScreen:"appointments",onNavigate:e,children:r.jsxs("div",{style:{textAlign:"center",padding:"30px 0",color:t.error,background:"white",borderRadius:12,marginTop:16},children:[r.jsx("div",{style:{fontSize:40,marginBottom:16},children:"🔒"}),r.jsx("h3",{children:"Acceso no autorizado"}),r.jsx("p",{children:"Debe iniciar sesión como profesional para ver las citas."})]})})};export{Y as default};
